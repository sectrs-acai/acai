all: example fh_fixup_mod fh_fixup.o header example2
CCFLAGS += -Wno-unused-variable
EXTRA_CFLAGS = -Wno-unused-function  -Wno-declaration-after-statement -Wno-format

header: mod/fh_fixup_mod.c mod/fh_fixup_mod.h fh_fixup.c fh_fixup.h
	echo "#pragma once" > fh_fixup_header.h
	cat mod/fh_fixup_mod.h fh_fixup.h fh_fixup.c | \
	sed -e 's/#include ".*"//g' -e "1i // Warning: this file was generated by make. DO NOT EDIT!" | sed 's/#define fh_fixup_fn/#define fh_fixup_fn static/g' >> fh_fixup_header.h

fh_fixup_mod: mod/fh_fixup_mod.c
	cd mod && $(MAKE)

example: example.c header
	$(CC) -Wall -Wextra example.c -g -o example

example2: example_2.c header
	$(CC) -Wall -Wextra example_2.c -g -o $@

clean:
	cd mod && $(MAKE) clean
	rm -f example *.o
