# custom config
CONFIG_NETCONSOLE=y

# XXX: Disable this for benchmarks
CONFIG_DEBUG_FS=n
CONFIG_DEBUG_INFO=n
CONFIG_DEBUG_KERNEL=n
CONFIG_GDB_SCRIPTS=n


# zcat /proc/config.gz
CONFIG_IKCONFIG=y
CONFIG_IKCONFIG_PROC=y

# This seems to allow userspace to create arbitrary configuration trees,
# which kernel modules can then read and interpret.
CONFIG_CONFIGFS_FS=y

# KGDB
CONFIG_CONSOLE_POLL=y
CONFIG_KDB_CONTINUE_CATASTROPHIC=0
CONFIG_KDB_DEFAULT_ENABLE=0x1
CONFIG_KDB_KEYBOARD=y
CONFIG_KGDB=y
CONFIG_KGDB_KDB=y
CONFIG_KGDB_LOW_LEVEL_TRAP=y
CONFIG_KGDB_SERIAL_CONSOLE=y
CONFIG_KGDB_TESTS=y
CONFIG_KGDB_TESTS_ON_BOOT=n
CONFIG_MAGIC_SYSRQ=y
CONFIG_MAGIC_SYSRQ_DEFAULT_ENABLE=0x1
CONFIG_SERIAL_KGDB_NMI=n

CONFIG_MODVERSIONS=y

# Required for Debian Stretch
CONFIG_CONFIGFS_FS=y
CONFIG_SECURITYFS=y

# https://stackoverflow.com/questions/1414968/how-do-i-configure-the-linux-kernel-within-buildroot
CONFIG_DEBUG_FS=y
CONFIG_KALLSYMS=y

# 9P support
CONFIG_NET_9P=y
CONFIG_NET_9P_VIRTIO=y
CONFIG_NET_9P_DEBUG=y
CONFIG_9P_FS=y
CONFIG_9P_FS_POSIX_ACL=y
CONFIG_PCI=y
CONFIG_VIRTIO_PCI=y
CONFIG_PCI=y
CONFIG_VIRTIO_PCI=y

CONFIG_STRICT_DEVMEM=n
CONFIG_IO_STRICT_DEVMEM=n

CONFIG_MMIOTRACE=n
CONFIG_MMIOTRACE_TEST=n
CONFIG_TRACING=n

CONFIG_FVP_ESCAPE=y
CONFIG_ARCH_KEEP_MEMBLOCK=y

CONFIG_MEMORY_FAILURE=y

# disable idle driver to speed up fvp
CONFIG_CPU_IDLE=n

CONFIG_LOG_BUF_SHIFT=26

CONFIG_DEFERRED_STRUCT_PAGE_INIT=y


# lkvm
CONFIG_SERIAL_8250=y
CONFIG_SERIAL_8250_CONSOLE=y
CONFIG_EXT2_FS=y
CONFIG_VIRTIO=y
CONFIG_VIRTIO_RING=y
CONFIG_VIRTIO_PCI=y
CONFIG_VIRTIO_BLK=y
CONFIG_VIRTIO_BALLOON=y
CONFIG_VIRTIO_CONSOLE=y
CONFIG_HW_RANDOM_VIRTIO=y


CONFIG_MODULE_FORCE_LOAD=y
CONFIG_PROFILING=n
MODULE_ALLOW_MISSING_NAMESPACE_IMPORTS=y
CONFIG_MEDIA_SUPPORT=n
CONFIG_DRM_NOUVEAU=n
CONFIG_SOUND=n


# enable force unload
CONFIG_MODULE_FORCE_UNLOAD=y
